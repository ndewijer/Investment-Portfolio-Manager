# Development Setup

## Prerequisites
- Docker and Docker Compose (recommended)
- Node.js 23+ and Python 3.13+ (for local development)

## Local Development

### Backend Setup

#### Using uv (Recommended)
```bash
# Install uv if not already installed
curl -LsSf https://astral.sh/uv/install.sh | sh

# Install all dependencies (from project root)
uv sync --frozen

# Run Flask
cd backend
uv run flask run
```

#### Using pip (Deprecated - will be removed in v1.4.0)
```bash
cd backend
python -m venv .venv
source .venv/bin/activate
pip install -r dev-requirements.txt
flask run
```

**Note**: All dependencies are managed in `pyproject.toml`. Requirements files are kept for backward compatibility only.

### Frontend Setup
```bash
cd frontend
npm install
npm start
```

## Development Tools
- ESLint and Prettier for frontend
- Ruff for backend (linting and formatting)
- uv for Python package management
- Pre-commit hooks for code quality

## Dependency Management

### Adding Dependencies
**Production** (pinned version):
```bash
# 1. Edit pyproject.toml [project.dependencies], add: "package==1.2.3"
# 2. Update lock and sync
uv lock
uv sync --frozen
```

**Development** (flexible range):
```bash
# 1. Edit pyproject.toml [dependency-groups.dev], add: "package>=1.0.0,<2.0.0"
# 2. Update lock and sync
uv lock
uv sync --frozen
```

### Updating Dependencies
```bash
# Update all to latest compatible versions
uv lock --upgrade
uv sync

# Update specific package
uv lock --upgrade-package package-name
uv sync
```

### Common Commands
| Task | Command |
|------|---------|
| Install dependencies | `uv sync --frozen` |
| Run tests | `uv run pytest backend/tests/` |
| Run Flask | `cd backend && uv run flask run` |
| Run linting | `uv run ruff check backend/` |

## Environment Setup
```bash
# Security (see docs/SECURITY.md for details)
INTERNAL_API_KEY=your-secure-key-here  # For automated tasks
IBKR_ENCRYPTION_KEY=<auto-generated>   # Optional: Encrypts IBKR tokens

# Paths
DB_DIR=/path/to/data/db
LOG_DIR=/path/to/data/logs
```

**ðŸ“– Security Configuration:**
See [docs/SECURITY.md](SECURITY.md) for complete information on:
- API key management
- IBKR token encryption
- Key generation and rotation
- Backup and migration procedures

## Automated Tasks
The application includes automated tasks for:
- Daily fund price updates (weekdays at 23:55)
- System maintenance and cleanup

These tasks require:
- Valid INTERNAL_API_KEY in environment
- Proper application context
- Database access

## Database Management

### Version Control
The application uses a centralized version management system:
```bash
# Check current version
cat backend/VERSION

# Create new migration
flask db revision -m "description"

# Apply migrations
flask db upgrade

# Rollback if needed
flask db downgrade
```

### Database Setup
```bash
# Fresh installation
flask db upgrade   # Creates and initializes database

# Development reset
flask db downgrade base  # Reset to empty state
flask db upgrade        # Apply all migrations
flask seed-db           # Add sample data
```

### Migration Development
When creating new migrations:
1. Update VERSION file with new version
2. Create migration script
3. Include proper error handling for:
   - Existing tables/indexes
   - Missing tables/indexes
   - Transaction management

Example migration pattern:
```python
from sqlalchemy.exc import OperationalError

def upgrade():
    try:
        # Create tables/indexes
    except OperationalError as e:
        if "already exists" not in str(e):
            raise e

def downgrade():
    try:
        # Drop tables/indexes
    except OperationalError as e:
        if "no such table" not in str(e):
            raise e
```

[Detailed development documentation...]
