# Remaining minimatch@3 Vulnerabilities in ESLint Chain

**Status**: Blocked on upstream package updates
**Severity**: High (5 packages, dev-only tooling — no runtime/production impact)
**As of**: 2026-02-22

---

## Background

The Dependabot advisory `GHSA-w7fw-mjwx-w883` flags `minimatch < 10.2.1` as vulnerable to
ReDoS (Regular Expression Denial of Service) via repeated wildcards with non-matching literals.

The project previously had 24 high-severity vulnerabilities. 18 were fixed by replacing Jest with
Vitest (PR #158), which removed the `babel-jest → babel-plugin-istanbul → test-exclude → minimatch@3`
chain entirely. The remaining 5 vulnerabilities all live in the ESLint toolchain.

---

## Affected Packages

| Package | Severity | Via | npm audit fix |
|---------|----------|-----|---------------|
| `eslint@9.x` | high | `minimatch@3`, `@eslint/config-array`, `@eslint/eslintrc` | requires `eslint@10.0.1` (major) |
| `@eslint/config-array` | high | `minimatch@3` | requires `eslint@10.0.1` (major) |
| `@eslint/eslintrc` | high | `minimatch@3` | requires `@eslint/eslintrc@0.1.0` (major, downgrade?!) |
| `eslint-plugin-jsx-a11y@6.x` | high | `minimatch@3` | no non-breaking fix |
| `eslint-plugin-react@7.x` | high | `minimatch@3` | no non-breaking fix |

All are **devDependencies** used only for linting. They are not present in the production build
or runtime bundle.

---

## Why a Simple Fix Doesn't Work

### Attempt 1: Blanket npm `overrides`

Adding `"overrides": { "minimatch": "^10.2.2" }` to `package.json` forces all packages to
resolve minimatch to v10. This fixes the vulnerability scanner but **breaks the tools at runtime**.

**Root cause**: minimatch changed its export API between v3 and v10:

```js
// minimatch@3 CJS export:
module.exports = function minimatch(str, pattern, options) { ... }
// require('minimatch') returns the function directly

// minimatch@10 CJS export:
module.exports = { minimatch, Minimatch, filter, sep, GLOBSTAR, ... }
// require('minimatch') returns an object, NOT the function
```

Packages compiled from ESM/TypeScript with Babel interop do:
```js
// Compiled from: import minimatch from 'minimatch'
const _minimatch = _interopRequireDefault(require('minimatch'));
// With minimatch@3: _minimatch.default = the function ✓
// With minimatch@10: _minimatch.default = { minimatch, Minimatch, ... } — not a function ✗
```

This breaks:
- `@eslint/eslintrc` — ESM file, uses `import minimatch from "minimatch"` (no default export in v10 ESM)
- `eslint-plugin-jsx-a11y` — CJS compiled from ESM, `(0, _minimatch.default)` fails
- `eslint-plugin-react` — same pattern as jsx-a11y
- `eslint` itself — via `@eslint/config-array` which uses the same broken interop

### Attempt 2: Upgrade to eslint@10

`eslint@10.0.1` is published and uses minimatch@10 with the correct named import
(`import { minimatch } from 'minimatch'`). However:

- `eslint-plugin-react@7.37.5` peer dep: `eslint@"^3 || ^4 || ^5 || ^6 || ^7 || ^8 || ^9.7"` — **no @10**
- `eslint-plugin-jsx-a11y@6.10.2` peer dep: `eslint@"^3 || ^4 || ^5 || ^6 || ^7 || ^8 || ^9"` — **no @10**

Installing eslint@10 alongside these plugins causes peer dependency conflicts and likely
runtime errors as the plugin APIs may have changed.

### Attempt 3: Per-package selective overrides

npm `overrides` can be scoped per-package:
```json
"overrides": {
  "eslint": { "minimatch": "^10.2.2" },
  "@eslint/config-array": { "minimatch": "^10.2.2" }
}
```
This doesn't help because the packages themselves use the old import style — forcing a newer
minimatch version on them still causes the broken interop described in Attempt 1.

---

## What Needs to Happen (Upstream)

For the vulnerabilities to be fixable, the following packages need to publish new versions
that use `import { minimatch } from 'minimatch'` (named import) instead of the default import:

1. **`eslint-plugin-react`** — needs to update minimatch usage AND add eslint@10 to peer deps
2. **`eslint-plugin-jsx-a11y`** — same
3. **OR** both just need to bump their minimum required eslint to `^10`, which in turn would
   pull in a patched `@eslint/config-array` and `@eslint/eslintrc`

Monitor these:
- https://github.com/jsx-eslint/eslint-plugin-react/releases
- https://github.com/jsx-eslint/eslint-plugin-jsx-a11y/releases

---

## Fix Procedure (When Upstream is Ready)

Once `eslint-plugin-react` and `eslint-plugin-jsx-a11y` publish versions with eslint@10 support:

### Step 1 — Update eslint ecosystem packages

```bash
cd frontend
npx ncu -u --filter "eslint,eslint-plugin-react,eslint-plugin-jsx-a11y,@eslint/js,@eslint/eslintrc,@eslint/config-array,@eslint/compat"
npm install
```

### Step 2 — Update `eslint.config.mjs`

The current config uses `FlatCompat` from `@eslint/eslintrc` to wrap legacy plugin configs.
Once plugins support native flat config (which `eslint-plugin-react@7.x` already does via
`react.configs.flat`), remove the FlatCompat wrapper:

```js
// BEFORE (current eslint.config.mjs)
import { FlatCompat } from "@eslint/eslintrc";
const compat = new FlatCompat({ ... });
export default [...fixupConfigRules(compat.extends(
  "plugin:react/recommended",
  "plugin:react-hooks/recommended",
  ...
)), { ... }];

// AFTER (target — no FlatCompat needed)
import react from "eslint-plugin-react";
import reactHooks from "eslint-plugin-react-hooks";
import jsxA11y from "eslint-plugin-jsx-a11y";
import js from "@eslint/js";
import eslintConfigPrettier from "eslint-config-prettier";

export default [
  js.configs.recommended,
  react.configs.flat.recommended,
  react.configs.flat["jsx-runtime"],
  reactHooks.configs.flat.recommended,   // check export name in new version
  jsxA11y.flatConfigs.recommended,
  eslintConfigPrettier,
  {
    plugins: { jsdoc },
    // ... rest of config unchanged
  },
];
```

This removes `@eslint/eslintrc` as an import entirely, which eliminates its minimatch@3
vulnerability from the load path (even if the package remains installed as an eslint dep).

### Step 3 — Verify

```bash
npm run lint       # ESLint must pass
npm test           # All 575 tests must pass
npm audit          # Should show 0 vulnerabilities
```

### Step 4 — Also remove `@eslint/compat` and `@eslint/eslintrc` from devDependencies

Once FlatCompat is removed from the config, these packages are no longer directly imported
and can be removed:

```bash
npm uninstall @eslint/compat @eslint/eslintrc
```

---

## Current State Summary

```
npm audit: 6 high severity vulnerabilities (was 24 before PR #158)
All in: frontend/node_modules (devDependencies only)
Production bundle: unaffected
```

```
eslint@9.39.x
├── @eslint/config-array     ← uses minimatch@3.1.3  (VULNERABLE)
├── @eslint/eslintrc         ← uses minimatch@3.1.3  (VULNERABLE)
└── minimatch@3.1.3          ← directly                (VULNERABLE)
eslint-plugin-jsx-a11y       ← uses minimatch@3.1.3  (VULNERABLE)
eslint-plugin-react          ← uses minimatch@3.1.3  (VULNERABLE)
```
